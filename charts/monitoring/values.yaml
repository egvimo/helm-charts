kube-prometheus-stack:
  crds:
    enabled: true
    upgradeJob:
      enabled: true
      forceConflicts: true
  alertmanager:
    enabled: true
    config:
      route:
        receiver: 'null'
        group_by: ['alertname', 'namespace']
        routes:
          - receiver: "apprise"
            matchers:
              - severity =~ "info|warning|critical"
              - alertname !~ "NodeClockNotSynchronising"
      receivers:
        - name: 'null'
        - name: "apprise"
          webhook_configs:
            - url: "http://apprise.apprise.svc.cluster.local/webhook/alertmanager?config_key=apprise&tag=alerts"
  grafana:
    grafana.ini:
      server:
        root_url: "{{ if (and .Values.ingress.enabled .Values.ingress.hosts) }}https://{{ tpl (.Values.ingress.hosts | first) . }}{{ else }}''{{ end }}"
    defaultDashboardsTimezone: Europe/Berlin
    ingress:
      enabled: true
      hosts:
        - grafana.192-168-178-31.sslip.io
    alerting:
      contactpoints.yaml:
        apiVersion: 1
        contactPoints:
          - orgId: 1
            name: apprise
            receivers:
              - uid: apprise
                type: webhook
                settings:
                  url: http://apprise.apprise.svc.cluster.local/notify/apprise
                  httpMethod: POST
                  payload:
                    template: |-
                      {{`{{ define "apprise.custom.payload" -}}`}}
                      {{`  {{ coll.Dict`}}
                      {{`  "title" (printf "%s %s"`}}
                      {{`     (tmpl.Inline "{{ if eq .Status \"resolved\" }}‚úÖ{{ else if eq .Status \"firing\" }}üî•{{ else }}‚ÑπÔ∏è{{ end }}" . )`}}
                      {{`     (tmpl.Exec "default.title" . ))`}}
                      {{`  "body" (tmpl.Exec "default.message" . )`}}
                      {{`  "tag" "alerts"`}}
                      {{`  | data.ToJSONPretty " "}}`}}
                      {{`{{- end }}`}}
                      {{`{{ template "apprise.custom.payload" . }}`}}
        policies:
          - orgId: 1
            receiver: apprise
            routes:
              - receiver: apprise
                matchers:
                  - receiver = "apprise"
              - receiver: apprise
                matchers:
                  - severity =~ "info|warning|critical"
            repeat_interval: 10h
    sidecar:
      alerts:
        enabled: true
  kubeApiServer:
    enabled: false
  kubelet:
    enabled: true
  kubeControllerManager:
    enabled: false
  coreDns:
    enabled: false
  kubeDns:
    enabled: false
  kubeEtcd:
    enabled: false
  kubeScheduler:
    enabled: false
  kubeProxy:
    enabled: false
  kubeStateMetrics:
    enabled: true
  prometheus:
    prometheusSpec:
      ruleSelectorNilUsesHelmValues: false
      serviceMonitorSelectorNilUsesHelmValues: false
      serviceMonitorNamespaceSelector:
        matchLabels:
          export-prometheus-metrics: "true"
      maximumStartupDurationSeconds: 900

prometheus-smartctl-exporter:
  serviceMonitor:
    enabled: true
  prometheusRules:
    enabled: true
  image:
    # TODO Revert to default prometheus-community image when multi-arch is re-enabled (#105)
    repository: ghcr.io/home-operations/smartctl-exporter
    tag: "0.14.0"

file-exporter:
  enabled: true
